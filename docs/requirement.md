# 콘서트 예매 시스템 요구사항 명세서

## 개요

본 문서는 VMC3 콘서트 예매 시스템의 **유저플로우 #2 "예약 페이지 - 날짜 선택"** 기능에 대한 상세 요구사항을 정의합니다. 90초 내 예매 완료 목표를 달성하기 위한 빠르고 직관적인 날짜 선택 화면을 구현합니다.

---

## 🎯 **핵심 목표**

- **속도**: 날짜 선택 후 1초 이내 회차 정보 로드
- **직관성**: 시각적으로 명확한 캘린더 인터페이스 제공
- **정확성**: 실시간 예매 가능 날짜 상태 반영
- **접근성**: 모든 연령대가 쉽게 사용할 수 있는 UI/UX

---

## 📋 **기능 요구사항**

### **1. 페이지 진입 및 초기화**

#### **1.1 URL 파라미터 처리**
- **입력**: `/booking/[concertId]` 형태의 URL
- **처리**: 
  - `concertId` 추출 및 UUID 형식 유효성 검증
  - 유효하지 않은 ID인 경우 404 에러 페이지로 리다이렉트
- **데이터베이스**: `concerts` 테이블에서 해당 ID 존재 여부 확인

#### **1.2 콘서트 기본 정보 로드**
- **데이터 조회**: 
  ```sql
  SELECT id, title, description, poster_image_url 
  FROM concerts 
  WHERE id = $concertId
  ```
- **화면 표시**:
  - 콘서트 제목 (상단 헤더)
  - 포스터 이미지 (16:9 비율, 최대 400px 너비)
  - 간략한 설명 (2-3줄 요약)
- **로딩 상태**: 스켈레톤 UI로 로딩 중 표시

#### **1.3 예매 가능한 날짜 조회**
- **데이터 조회**:
  ```sql
  SELECT DISTINCT DATE(date_time) as available_date
  FROM schedules 
  WHERE concert_id = $concertId 
    AND date_time > NOW()
  ORDER BY available_date
  ```
- **데이터 변화**: 조회된 날짜들을 캘린더에서 활성화 상태로 표시
- **캐싱**: Redis에 5분간 캐시하여 성능 최적화

### **2. 캘린더 인터페이스**

#### **2.1 캘린더 렌더링**
- **표시 범위**: 현재 월부터 최대 6개월까지
- **날짜 상태 구분**:
  - **예매 가능**: Primary Color (#5C6BFF) 배경, 클릭 가능
  - **예매 불가**: 회색 배경, 클릭 불가
  - **과거 날짜**: 연한 회색, 비활성화
  - **선택된 날짜**: 진한 보라색 (#4854FF) 배경, 흰색 텍스트
- **반응형 디자인**:
  - 모바일: 전체 너비, 터치 최적화된 날짜 셀 (최소 44px)
  - 데스크톱: 최대 600px 너비, 마우스 호버 효과

#### **2.2 캘린더 네비게이션**
- **월 이동**: 이전/다음 월 버튼
- **처리 속도**: 즉시 반응 (애니메이션 없음)
- **제한**: 현재 월 이전으로는 이동 불가

### **3. 날짜 선택 처리**

#### **3.1 클릭 이벤트 처리**
- **유효성 검증**:
  - 과거 날짜 클릭 시: "선택할 수 없는 날짜입니다" 툴팁 표시
  - 비활성화된 날짜 클릭 시: "해당 날짜는 예매가 불가능합니다" 안내
- **시각적 피드백**: 클릭 시 즉시 선택 상태로 변경 (150ms 애니메이션)

#### **3.2 회차 정보 조회**
- **트리거**: 유효한 날짜 클릭 시
- **데이터 조회**:
  ```sql
  SELECT 
    s.id,
    s.date_time,
    COUNT(CASE WHEN st.status = 'available' THEN 1 END) as available_seats,
    COUNT(st.id) as total_seats
  FROM schedules s
  LEFT JOIN seats st ON s.id = st.schedule_id
  WHERE s.concert_id = $concertId 
    AND DATE(s.date_time) = $selectedDate
    AND s.date_time > NOW()
  GROUP BY s.id, s.date_time
  ORDER BY s.date_time
  ```
- **데이터 변화**: 
  - 회차 선택 섹션 활성화
  - 각 회차별 시간 및 잔여 좌석 수 표시
  - 매진된 회차는 "매진" 표시 및 비활성화

#### **3.3 상태 저장**
- **세션 스토리지**: 선택된 날짜 정보 저장
- **저장 데이터**: 
  ```json
  {
    "concertId": "uuid",
    "selectedDate": "2024-12-25",
    "timestamp": 1703500800000
  }
  ```
- **유지 기간**: 브라우저 세션 종료까지

### **4. 회차 선택 섹션**

#### **4.1 회차 목록 표시**
- **레이아웃**: 
  - 시간순 정렬 (오름차순)
  - 카드 형태로 각 회차 표시
- **표시 정보**:
  - 시작 시간 (HH:MM 형식)
  - 잔여 좌석 수 / 전체 좌석 수
  - 예매 가능 여부 (매진 시 "SOLD OUT" 표시)
- **상태별 스타일링**:
  - **예매 가능**: 흰색 배경, 클릭 가능
  - **매진**: 회색 배경, "매진" 뱃지, 클릭 불가
  - **선택됨**: Primary Color 테두리, 체크 아이콘

#### **4.2 회차 선택 처리**
- **클릭 이벤트**: 예매 가능한 회차만 선택 가능
- **데이터 변화**: 
  - 좌석 선택 섹션 활성화
  - 선택된 회차 정보 세션에 저장
- **다음 단계**: 좌석 배치도 로드 (유저플로우 #4)

---

## 🔧 **기술적 요구사항**

### **1. 성능 요구사항**
- **초기 로드**: 3초 이내 완료
- **날짜 선택 응답**: 1초 이내 회차 정보 표시
- **캐싱**: Redis를 통한 데이터 캐싱으로 응답 속도 향상

### **2. 데이터베이스 요구사항**
- **사용 테이블**:
  - `concerts`: 콘서트 기본 정보
  - `schedules`: 공연 일정 정보
  - `seats`: 좌석 정보 (잔여 좌석 수 계산용)
- **인덱스**: 
  - `schedules(concert_id, date_time)` 복합 인덱스
  - `seats(schedule_id, status)` 복합 인덱스

### **3. API 엔드포인트**
- `GET /api/concerts/{concertId}`: 콘서트 기본 정보
- `GET /api/concerts/{concertId}/schedules`: 예매 가능한 날짜 목록
- `GET /api/schedules?concertId={id}&date={date}`: 특정 날짜의 회차 정보

---

## 🎨 **UI/UX 요구사항**

### **1. 디자인 시스템**
- **색상**: Design Guide의 Primary Color (#5C6BFF) 사용
- **타이포그래피**: Inter 폰트, 명확한 계층 구조
- **간격**: 8px 기본 그리드 시스템 적용

### **2. 반응형 디자인**
- **모바일 (< 768px)**:
  - 캘린더 전체 너비 사용
  - 터치 친화적인 날짜 셀 크기 (최소 44px)
  - 회차 목록 세로 스택 배치
- **데스크톱 (≥ 768px)**:
  - 캘린더와 회차 선택을 좌우 분할 레이아웃
  - 마우스 호버 효과 적용

### **3. 접근성**
- **키보드 네비게이션**: Tab 키로 날짜 이동 가능
- **스크린 리더**: ARIA 라벨로 날짜 상태 안내
- **색상 독립성**: 색상 외에도 텍스트/아이콘으로 상태 구분

---

## ⚠️ **예외 처리 요구사항**

### **1. 데이터 오류**
- **유효하지 않은 콘서트 ID**: 404 페이지로 리다이렉트
- **예매 가능한 날짜 없음**: "현재 예매 가능한 일정이 없습니다" 메시지
- **서버 오류**: "일시적인 오류가 발생했습니다" + 재시도 버튼

### **2. 네트워크 오류**
- **연결 실패**: "네트워크 연결을 확인해주세요" + 재시도 버튼
- **타임아웃**: 3초 후 타임아웃 메시지 표시
- **오프라인**: 브라우저 오프라인 상태 감지 및 안내

### **3. 사용자 입력 오류**
- **과거 날짜 선택**: 클릭 무시 + 툴팁 안내
- **비활성 날짜 선택**: 클릭 무시 + 안내 메시지
- **빠른 연속 클릭**: 디바운싱으로 중복 요청 방지

---

## 📊 **데이터 플로우**

### **1. 초기 로드 플로우**
```
사용자 페이지 진입
    ↓
URL에서 concertId 추출
    ↓
concerts 테이블에서 콘서트 정보 조회
    ↓
schedules 테이블에서 예매 가능한 날짜 조회
    ↓
캘린더에 활성 날짜 표시
```

### **2. 날짜 선택 플로우**
```
사용자 날짜 클릭
    ↓
클라이언트 유효성 검증
    ↓
schedules + seats 테이블 JOIN 쿼리
    ↓
회차별 잔여 좌석 수 계산
    ↓
회차 선택 UI 활성화
    ↓
선택 정보 세션 저장
```

### **3. 실시간 데이터 동기화**
- **폴링 주기**: 30초마다 좌석 상태 확인
- **WebSocket**: 실시간 좌석 상태 업데이트 (선택사항)
- **캐시 무효화**: 예약 발생 시 관련 캐시 삭제

---

## 🔍 **테스트 요구사항**

### **1. 기능 테스트**
- 유효한/유효하지 않은 콘서트 ID 처리
- 예매 가능/불가능한 날짜 클릭 처리
- 회차 정보 정확한 로드 확인
- 세션 저장 및 복원 테스트

### **2. 성능 테스트**
- 초기 로드 시간 측정 (목표: 3초 이내)
- 날짜 선택 응답 시간 측정 (목표: 1초 이내)
- 동시 사용자 100명 기준 부하 테스트

### **3. 접근성 테스트**
- 키보드 네비게이션 동작 확인
- 스크린 리더 호환성 테스트
- 색상 대비 비율 검증 (최소 4.5:1)

---

## 📈 **성공 지표**

### **1. 사용성 지표**
- 날짜 선택 완료율: 95% 이상
- 평균 날짜 선택 시간: 10초 이내
- 오류 발생률: 1% 이하

### **2. 성능 지표**
- 페이지 로드 시간: 3초 이내
- API 응답 시간: 1초 이내
- 캐시 히트율: 80% 이상

### **3. 비즈니스 지표**
- 예매 전환율: 날짜 선택 → 회차 선택 90% 이상
- 이탈률: 날짜 선택 단계에서 10% 이하
- 사용자 만족도: 4.5/5.0 이상

이 요구사항 명세서는 90초 내 예매 완료 목표를 달성하기 위한 효율적이고 직관적인 날짜 선택 기능을 구현하는 데 필요한 모든 요소를 포함합니다.